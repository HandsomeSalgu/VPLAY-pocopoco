<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pocopoco_vplay.board.model.mapper.BoardMapper">
	<select id="selectCategory" resultType="map">
		SELECT content.views,content.content_no,content.content_title,TO_CHAR(content.content_detail) as content_detail, menu.menu_name, likes.user_no as likesUser,
		(select count(*) from likes l2 where l2.content_no = content.content_no) as like_count
		FROM content
		left JOIN board ON content.content_no = board.content_no
		left JOIN content_category on content.content_no = content_category.content_no
		left join category on content_category.category_no = category.category_no
		left JOIN menu ON category.menu_no = menu.menu_no
		left JOIN likes ON content.content_no = likes.content_no
		WHERE board.board_type is null and likes.user_no=#{userNo} and menu_name is not null
		<if test="menu != 'All'">
			AND menu.menu_name =#{menu}
		</if>
		<if test="sort == 'newest'">
			order by content.create_date
		</if>
		t
		<if test="sort == 'mostView'">
			order by content.views desc
		</if>
	</select>

	<select id="selectCategoryMyProjects">
		SELECT c.*,
		(SELECT COUNT(*) FROM likes WHERE likes.content_no = c.content_no) AS like_count
		FROM content c
		left JOIN board b ON c.content_no = b.content_no
		left JOIN content_category cc on c.content_no = cc.content_no
		left join category ccc on cc.category_no = ccc.category_no
		left JOIN menu m ON ccc.menu_no = m.menu_no
		WHERE c.user_no =3 and b.board_type is null and m.menu_name is not null and c.content_status='Y'
		<if test="menu != 'All'">
			AND m.menu_name =#{menu}
		</if>
		<if test="sort == 'newest'">
			order by c.create_date
		</if>
		<if test="sort == 'mostView'">
			order by c.views desc
		</if>
	</select>

	<select id="selectMyInquiry">
		select * from content
		join board using(content_no)
		where board_type=1 and user_no=#{userNo} and content_status='Y'
	</select>
	<update id="throwBoardTrash">
		update content set content_status ='N' where content_no=#{contentNo}
	</update>

	<select id="selectMyTrash">
		select c.*,(SELECT COUNT(*) FROM likes WHERE likes.content_no = c.content_no) AS like_count , b.board_type,m.menu_name
		from content c
		left join board b on c.content_no = b.content_no
		left JOIN content_category cc on c.content_no = cc.content_no
		left join category ccc on cc.category_no = ccc.category_no
		left JOIN menu m ON ccc.menu_no = m.menu_no
		where c.user_no=#{userNo} and b.board_type is null and m.menu_name is not null and c.content_status='N'
	</select>

	<select id="selectCategoryMyTrash">
		SELECT c.*,
		(SELECT COUNT(*) FROM likes WHERE likes.content_no = c.content_no) AS like_count
		FROM content c
		left JOIN board b ON c.content_no = b.content_no
		left JOIN content_category cc on c.content_no = cc.content_no
		left join category ccc on cc.category_no = ccc.category_no
		left JOIN menu m ON ccc.menu_no = m.menu_no
		WHERE c.user_no =3 and b.board_type is null and m.menu_name is not null and c.content_status='N'
		<if test="menu != 'All'">
			AND m.menu_name =#{menu}
		</if>
		<if test="sort == 'newest'">
			order by c.create_date
		</if>
		<if test="sort == 'mostView'">
			order by c.views desc
		</if>
	</select>
	
	<select id="allTemplateList" parameterType="string">
		select *
		from (select *
			 from content co
			 left join users u on(co.user_no = u.user_no)
		     left join board b on(co.content_no = b.content_no)
		     left join content_category coa on(co.content_no = coa.content_no)
		     left join category ca on(ca.category_no = coa.category_no)
		     left join menu me on(ca.menu_no = me.menu_no)
		where b.board_type is null and me.menu_name = #{menuName}
		order by co.content_no desc) 
		<if test="menuName == 'video Templates'">
		where rownum <![CDATA[<]]>= 3
		</if>
		<if test="menuName == 'Music'">
		where rownum <![CDATA[<]]>= 6
		</if>
		<if test="menuName == 'Sound Effects'">
		where rownum <![CDATA[<]]>= 5
		</if>
		<if test="menuName == 'Graphic Templates'">
		where rownum <![CDATA[<]]>= 3
		</if>
		<if test="menuName == 'Stock Video'">
		where rownum <![CDATA[<]]>= 3
		</if>
		<if test="menuName == 'Photos'">
		where rownum <![CDATA[<]]>= 3
		</if>
		<if test="menuName == 'Fonts'">
		where rownum <![CDATA[<]]>= 5
		</if>
	</select>

	<insert id="insertInquiry" parameterType="Content" useGeneratedKeys="true" keyProperty="contentNo">
		<selectKey resultType="int" keyProperty="contentNo" order="BEFORE">
			SELECT VPLAY.CONTENT_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO CONTENT (
		CONTENT_NO,
		USER_NO,
		CONTENT_TITLE,
		CONTENT_DETAIL,
		CREATE_DATE,
		MODIFY_DATE,
		CONTENT_STATUS,
		VIEWS
		) VALUES (
		#{contentNo},
		#{userNo},
		#{contentTitle},
		#{contentDetail},
		SYSDATE,
		SYSDATE,
		'Y',
		0
		)
	</insert>

	<insert id="insertBoard">
		INSERT INTO BOARD (
		CONTENT_NO,
		BOARD_TYPE,
		MENU_NO
		) VALUES (
		#{contentNo},
		1,
		#{menuNo}
		)
	</insert>

	<select id="selectInquiry" resultType="Content">
		SELECT
		C.CONTENT_NO,
		C.USER_NO,
		C.CONTENT_TITLE,
		C.CONTENT_DETAIL,
		C.CREATE_DATE,
		C.MODIFY_DATE,
		C.CONTENT_STATUS,
		C.VIEWS,
		B.MENU_NO
		FROM
		CONTENT C
		JOIN
		BOARD B ON C.CONTENT_NO = B.CONTENT_NO
		WHERE
		C.CONTENT_NO = #{contentNo}
	</select>

	<update id="updateInquiry" parameterType="Content">
		UPDATE CONTENT
		SET
		CONTENT_TITLE = #{contentTitle},
		CONTENT_DETAIL = #{contentDetail},
		MODIFY_DATE = SYSDATE
		WHERE
		CONTENT_NO = #{contentNo}
	</update>

	<select id="getrequestPostCount">
		select count(*)
		from content
				 join board using(content_no)
		where board_type = 2
	</select>

	<select id="selectAllRequestPost">
		select *
		from content
				 join board using(content_no)
				 join menu using(menu_no)
				 join users using(user_no)
		where board_type = 2 and CONTENT_STATUS = 'Y'
		order by content_no desc
	</select>

	<select id="selectUser">
		select user_id
		from users
		where user_no = #{userNo}
	</select>


</mapper>